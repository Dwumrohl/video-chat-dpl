{"version":3,"sources":["server/firebase.js","components/AuthenticatedApp/index.jsx","components/MeetingFooter/MeetingFooter.component.js","components/Shared/Card/Card.component.js","components/Participants/Participant/Participant.component.js","components/Participants/Participants.component.js","store/actiontypes.js","store/actioncreator.js","components/MainScreen/MainScreen.component.js","context/auth.js","hooks/useAuth.js","App.js","components/Router/router.jsx","components/UnauthenticatedApp/index.jsx","start.js","reportWebVitals.js","server/peerConnection.js","store/reducer.js","index.js"],"names":["app","initializeApp","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","databaseURL","auth","getAuth","db","getFirestore","firepadRef","ref","getDatabase","loginWithGoogle","a","provider","GoogleAuthProvider","signInWithPopup","user","q","query","collection","where","uid","getDocs","docs","length","addDoc","name","displayName","authProvider","email","code","console","error","onAuthStateChanged","logout","signOut","AuthenticatedApp","useState","room","setRoom","romTemp","className","onClick","roomId","URLSearchParams","window","location","search","get","child","push","key","roomTemp","localStorage","setItem","href","onSubmit","event","preventDefault","log","type","value","onChange","e","target","required","placeholder","MeetingFooter","props","mic","video","screen","streamState","setStreamState","setScreenState","isEnabled","currentState","useEffect","onMicClick","onVideoClick","data-tip","icon","faMicrophone","faMicrophoneSlash","title","faVideo","faVideoSlash","onScreenClick","disabled","faDesktop","faSignOutAlt","Card","children","Participant","curentIndex","currentParticipant","hideVideo","videoRef","showAvatar","currentUser","id","autoPlay","playsInline","audio","style","background","avatarColor","connect","state","participants","stream","mainStream","useRef","participantKey","Object","keys","current","srcObject","muted","values","gridCol","gridColSize","gridRowSize","Math","ceil","screenPresenter","find","element","map","index","pc","peerConnection","remoteStream","MediaStream","ontrack","streams","getTracks","forEach","track","addTrack","videElement","document","getElementById","SET_MAIN_STREAM","ADD_PARTICIPANT","REMOVE_PARTICIPANT","SET_USER","UPDATE_USER","UPDATE_PARTICIPANT","setMainStream","payload","dispatch","updateUser","participantRef","updateStream","sender","getSenders","s","kind","replaceTrack","getVideoTracks","onScreenShareEnd","navigator","mediaDevices","getUserMedia","localStream","enabled","getDisplayMedia","mediaStream","mediaSource","onended","micEnabled","getAudioTracks","videoEnabled","AuthContext","React","createContext","AuthProvider","useAuthState","login","setTimeout","Provider","useAuth","useContext","Error","addParticipant","newUser","setUser","removeParticipant","userId","updateParticipant","getItem","urlTemp","pathname","split","urlRef","userName","getUserStream","onValue","connectedRef","snap","val","defaultPreference","userStatusRef","preferences","onDisconnect","remove","fpdRef","isUserSet","isStreamSet","onChildAdded","preferenceUpdateEvent1","preferenceUpdateEvent","onChildChanged","preferenceSnap","onChildRemoved","Router","path","UnauthenticatedApp","App","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","updatePreference","preference","currentParticipantRef1","currentParticipantRef","update","createOffer","receiverId","createdID","onicecandidate","candidate","toJSON","offerDescription","setLocalDescription","offer","sdp","set","initializeListensers","currentUserRef","currenOffers","snapshot","data","store","getState","setRemoteDescription","RTCSessionDescription","createAnswer","addIceCandidate","RTCIceCandidate","answer","answerDescription","otherUserId","participantRef1","defaultUserState","servers","iceServers","urls","iceCandidatePoolSize","generateColor","floor","random","toString","addConnection","RTCPeerConnection","newUserId","currentUserId","offerIds","sort","b","localeCompare","createStore","action","ReactDOM","render","StrictMode"],"mappings":"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","file":"static/js/main.37eaff03.chunk.js","sourcesContent":["import { initializeApp } from \"firebase/app\";\nimport { GoogleAuthProvider, signInWithPopup, getAuth, signOut, onAuthStateChanged} from 'firebase/auth';\nimport { getFirestore } from 'firebase/firestore';\nimport { getDatabase, push, ref, child, set} from \"firebase/database\";\nimport { collection, addDoc,getDocs,\n    query, where } from 'firebase/firestore';\n\nvar firebaseConfig = {\n  apiKey: \"AIzaSyCZzeoeLPf9RygQgYkvEI6q5c490KYeChY\",\n  authDomain: \"test-video-chat-4979b.firebaseapp.com\",\n  projectId: \"test-video-chat-4979b\",\n  storageBucket: \"test-video-chat-4979b.appspot.com\",\n  messagingSenderId: \"249820721403\",\n  appId: \"1:249820721403:web:9ce311e53144626720c05e\",\n  databaseURL: \"https://test-video-chat-4979b-default-rtdb.europe-west1.firebasedatabase.app/\"\n};\n// Initialize Firebase\n\nconst app = initializeApp(firebaseConfig);\nconst auth = getAuth();\nconst db = getFirestore(app);\n\n\nvar firepadRef = ref(getDatabase());\n//export const userName = prompt(\"What's your name?\");\nexport const userName = \"Олег\"; ////\n\nexport function roomTemp(){\n  const urlparams = new URLSearchParams(window.location.search);\n  const roomId = urlparams.get(\"id\");\n  \n  if (roomId) {\n    firepadRef = child(firepadRef, roomId);\n  } else {\n    //var tempRef = push(firepadRef);\n    firepadRef = push(firepadRef);\n    //window.history.replaceState(null, \"Meet\", firepadRef.key);\n  }\n  return firepadRef.key;\n}\n\n\nasync function loginWithGoogle() {\n  try {\n      const provider = new GoogleAuthProvider();       \n\n      const { user } = await signInWithPopup(auth, provider);\n      const q = query(collection(db, \"users\"), where(\"uid\", \"==\", user.uid));\n\n      const docs = await getDocs(q);\n      if (docs.docs.length === 0) {\n\n          await addDoc(collection(db, \"users\"), {\n      uid: user.uid,\n      name: user.displayName,\n      authProvider: \"google\",\n      email: user.email,\n    });\n  }\n      return { uid: user.uid, displayName: user.displayName };\n  } catch (error) {\n      if (error.code !== 'auth/cancelled-popup-request') {\n          console.error(error);\n      }\n\n      return null;\n  }\n}\n\nonAuthStateChanged(auth, (user) => {\n  if (user) {\n    // User is signed in.\n    // ...\n  } else {\n    // User is not signed in.\n    // ...\n  }\n});\n\nconst logout = () => {\n  signOut(auth);\n};\n\n\nexport default firepadRef;\nexport {loginWithGoogle, auth, db, logout};\n","import { userName, logout, roomTemp} from '../../server/firebase';\r\nimport {Link} from 'react-router-dom';\r\nimport React, {useState} from \"react\";\r\nimport \"./index.css\";\r\n\r\n// import { Landing } from '../Landing';\r\n// import { ChatRoom } from '../ChatRoom';\r\n\r\n\r\nfunction AuthenticatedApp() {\r\n    const [room, setRoom] = useState(\"\");\r\n    var romTemp = null;\r\n    //window.room = romTemp; \r\n    function testRoom(){\r\n        romTemp = roomTemp();\r\n        localStorage.setItem(\"roomId\",romTemp);\r\n        window.location.href='/room/'+romTemp;\r\n    }\r\n\r\n    const handleSubmit =  (event) => {\r\n        event.preventDefault();\r\n        localStorage.setItem(\"roomId\",room);\r\n        window.location.href='/room/' + room;\r\n        console.log(room);\r\n    }\r\n    return (\r\n        <div className='main'>\r\n        <div className='inner'>\r\n            <h3 className='welcome'>Добро пожаловать в приложение для видеосвязи!</h3>\r\n            <div className='divCreate'>\r\n                <button className=\"btns\" onClick={testRoom}>Создать комнату</button>\r\n            </div>\r\n            <div className='forma'>\r\n            <form onSubmit={handleSubmit}>\r\n                <label className='labelRoom'>Введите номер комнаты:</label>\r\n                <div className='inputRoom'>\r\n                <input\r\n                type=\"text\"\r\n                value={room}\r\n                onChange={(e) => setRoom(e.target.value)}\r\n                required\r\n                placeholder='Номер...'\r\n                className='inputRoom'></input>\r\n                </div>\r\n                <input className=\"btns\" type=\"submit\" value=\"Войти\"/>\r\n            </form>\r\n            </div>\r\n            <div className='divOut'>\r\n                <button className=\"leaveBtn\" onClick={logout}>Выход из аккаунта</button>\r\n            </div>\r\n        </div>\r\n        </div>\r\n        \r\n    );\r\n}\r\n\r\n\r\nexport { AuthenticatedApp };","import React, { useEffect, useState } from \"react\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport {\n  faMicrophone,\n  faVideo,\n  faDesktop,\n  faVideoSlash,\n  faMicrophoneSlash,\n  faSignOutAlt,\n} from \"@fortawesome/free-solid-svg-icons\";\nimport ReactTooltip from \"react-tooltip\";\nimport \"./MeetingFooter.css\";\nconst MeetingFooter = (props) => {\n  const [streamState, setStreamState] = useState({\n    mic: true,\n    video: false,\n    screen: false,\n  });\n  const micClick = () => {\n    setStreamState((currentState) => {\n      return {\n        ...currentState,\n        mic: !currentState.mic,\n      };\n    });\n  };\n\n  const onVideoClick = () => {\n    setStreamState((currentState) => {\n      return {\n        ...currentState,\n        video: !currentState.video,\n      };\n    });\n  };\n\n  const onLeaveClick = () => {\n    window.location.href = \"/\";\n  }\n\n  const onScreenClick = () => {\n    props.onScreenClick(setScreenState);\n  };\n\n  const setScreenState = (isEnabled) => {\n    setStreamState((currentState) => {\n      return {\n        ...currentState,\n        screen: isEnabled,\n      };\n    });\n  };\n  useEffect(() => {\n    props.onMicClick(streamState.mic);\n  }, [streamState.mic]);\n  useEffect(() => {\n    props.onVideoClick(streamState.video);\n  }, [streamState.video]);\n  return (\n    <div className=\"meeting-footer\">\n      <div\n        className={\"meeting-icons \" + (!streamState.mic ? \"active\" : \"\")}\n        data-tip={streamState.mic ? \"Выключить микрофон\" : \"Включить микрофон\"}\n        onClick={micClick}\n      >\n        <FontAwesomeIcon\n          icon={!streamState.mic ? faMicrophoneSlash : faMicrophone}\n          title=\"Mute\"\n        />\n      </div>\n      <div\n        className={\"meeting-icons \" + (!streamState.video ? \"active\" : \"\")}\n        data-tip={streamState.video ? \"Выключить камеру\" : \"Включить камеру\"}\n        onClick={onVideoClick}\n      >\n        <FontAwesomeIcon icon={!streamState.video ? faVideoSlash : faVideo} />\n      </div>\n      <div\n        className=\"meeting-icons\"\n        data-tip=\"Демонстрация экрана\"\n        onClick={onScreenClick}\n        disabled={streamState.screen}\n      >\n        <FontAwesomeIcon icon={faDesktop} />\n      </div>\n      <div \n      onClick={onLeaveClick}\n      className=\"meeting-icons\"\n      data-tip=\"Выйти\"\n      >\n          <FontAwesomeIcon icon={faSignOutAlt} />\n      </div>\n      <ReactTooltip />\n    </div>\n  );\n};\n\nexport default MeetingFooter;\n","import React from \"react\";\nimport \"./Card.css\";\n\nconst Card = (props) => {\n  return <div className=\"card\">{props.children}</div>;\n};\n\nexport default Card;\n","import React from \"react\";\nimport Card from \"../../Shared/Card/Card.component\";\nimport { faMicrophoneSlash } from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport \"./Participant.css\";\n\nexport const Participant = (props) => {\n  const {\n    curentIndex,\n    currentParticipant,\n    hideVideo,\n    videoRef,\n    showAvatar,\n    currentUser,\n  } = props;\n  if (!currentParticipant) return <></>;\n  return (\n    <div className={`participant ${hideVideo ? \"hide\" : \"\"}`}>\n      <Card>\n        <video\n          ref={videoRef}\n          className=\"video\"\n          id={`participantVideo${curentIndex}`}\n          autoPlay\n          playsInline\n        ></video>\n        {!currentParticipant.audio && (\n          <FontAwesomeIcon\n            className=\"muted\"\n            icon={faMicrophoneSlash}\n            title=\"Muted\"\n          />\n        )}\n        {showAvatar && (\n          <div\n            style={{ background: currentParticipant.avatarColor }}\n            className=\"avatar\"\n          >\n            {currentParticipant.name[0]}\n          </div>\n        )}\n        <div className=\"name\">\n          {currentParticipant.name}\n          {currentUser ? \"(Вы)\" : \"\"}\n        </div>\n      </Card>\n    </div>\n  );\n};\n","import React, { useEffect, useRef } from \"react\";\nimport \"./Participants.css\";\nimport { connect } from \"react-redux\";\nimport { Participant } from \"./Participant/Participant.component\";\n\nconst Participants = (props) => {\n  const videoRef = useRef(null);\n  let participantKey = Object.keys(props.participants);\n  useEffect(() => {\n    if (videoRef.current) {\n      videoRef.current.srcObject = props.stream;\n      videoRef.current.muted = true;\n    }\n  }, [props.currentUser, props.stream]);\n\n  const currentUser = props.currentUser\n    ? Object.values(props.currentUser)[0]\n    : null;\n\n  let gridCol =\n    participantKey.length === 1 ? 1 : participantKey.length <= 4 ? 2 : 4;\n  const gridColSize = participantKey.length <= 4 ? 1 : 2;\n  let gridRowSize =\n    participantKey.length <= 4\n      ? participantKey.length\n      : Math.ceil(participantKey.length / 2);\n\n  const screenPresenter = participantKey.find((element) => {\n    const currentParticipant = props.participants[element];\n    return currentParticipant.screen;\n  });\n\n  if (screenPresenter) {\n    gridCol = 1;\n    gridRowSize = 2;\n  }\n  const participants = participantKey.map((element, index) => {\n    const currentParticipant = props.participants[element];\n    const isCurrentUser = currentParticipant.currentUser;\n    if (isCurrentUser) {\n      return null;\n    }\n    const pc = currentParticipant.peerConnection;\n    const remoteStream = new MediaStream();\n    let curentIndex = index;\n    if (pc) {\n      pc.ontrack = (event) => {\n        event.streams[0].getTracks().forEach((track) => {\n          remoteStream.addTrack(track);\n        });\n        const videElement = document.getElementById(\n          `participantVideo${curentIndex}`\n        );\n        if (videElement) videElement.srcObject = remoteStream;\n      };\n    }\n\n    return (\n      <Participant\n        key={curentIndex}\n        currentParticipant={currentParticipant}\n        curentIndex={curentIndex}\n        hideVideo={screenPresenter && screenPresenter !== element}\n        showAvatar={\n          !currentParticipant.video &&\n          !currentParticipant.screen &&\n          currentParticipant.name\n        }\n      />\n    );\n  });\n  return (\n    <div\n      style={{\n        \"--grid-size\": gridCol,\n        \"--grid-col-size\": gridColSize,\n        \"--grid-row-size\": gridRowSize,\n      }}\n      className={`participants`}\n    >\n      {participants}\n      <Participant\n        currentParticipant={currentUser}\n        curentIndex={participantKey.length}\n        hideVideo={screenPresenter && !currentUser.screen}\n        videoRef={videoRef}\n        showAvatar={currentUser && !currentUser.video && !currentUser.screen}\n        currentUser={true}\n      />\n    </div>\n  );\n};\n\nconst mapStateToProps = (state) => {\n  return {\n    participants: state.participants,\n    currentUser: state.currentUser,\n    stream: state.mainStream,\n  };\n};\n\nexport default connect(mapStateToProps)(Participants);\n","export const SET_MAIN_STREAM = \"SET_MAIN_STREAM\";\nexport const ADD_PARTICIPANT = \"ADD_PARTICIPANT\";\nexport const REMOVE_PARTICIPANT = \"REMOVE_PARTICIPANT\";\nexport const SET_USER = \"SET_USER\";\nexport const UPDATE_USER = \"UPDATE_USER\";\nexport const UPDATE_PARTICIPANT = \"UPDATE_PARTICIPANT\";\n","import {\n  SET_MAIN_STREAM,\n  ADD_PARTICIPANT,\n  SET_USER,\n  REMOVE_PARTICIPANT,\n  UPDATE_USER,\n  UPDATE_PARTICIPANT,\n} from \"./actiontypes\";\n\nexport const setMainStream = (stream) => {\n  return {\n    type: SET_MAIN_STREAM,\n    payload: {\n      mainStream: stream,\n    },\n  };\n};\n\nexport const setUser = (user) => {\n  return {\n    type: SET_USER,\n    payload: {\n      currentUser: user,\n    },\n  };\n};\n\nexport const addParticipant = (user) => {\n  return {\n    type: ADD_PARTICIPANT,\n    payload: {\n      newUser: user,\n    },\n  };\n};\n\nexport const updateUser = (user) => {\n  return {\n    type: UPDATE_USER,\n    payload: {\n      currentUser: user,\n    },\n  };\n};\n\nexport const updateParticipant = (user) => {\n  return {\n    type: UPDATE_PARTICIPANT,\n    payload: {\n      newUser: user,\n    },\n  };\n};\n\nexport const removeParticipant = (userId) => {\n  return {\n    type: REMOVE_PARTICIPANT,\n    payload: {\n      id: userId,\n    },\n  };\n};\n","import React, { useRef, useEffect } from \"react\";\nimport MeetingFooter from \"../MeetingFooter/MeetingFooter.component\";\nimport Participants from \"../Participants/Participants.component\";\nimport \"./MainScreen.css\";\nimport { connect } from \"react-redux\";\nimport { setMainStream, updateUser } from \"../../store/actioncreator\";\n\nconst MainScreen = (props) => {\n  const participantRef = useRef(props.participants);\n\n  const onMicClick = (micEnabled) => {\n    if (micEnabled){\n      // const audio = new Audio(unmuteSound);\n      //   audio.play()\n    }else {\n      // const audio = new Audio(muteSound);\n      //   audio.play()\n    }\n    if (props.stream) {\n      props.stream.getAudioTracks()[0].enabled = micEnabled;\n      props.updateUser({ audio: micEnabled });\n    }\n  };\n  const onVideoClick = (videoEnabled) => {\n    if (props.stream) {\n      props.stream.getVideoTracks()[0].enabled = videoEnabled;\n      props.updateUser({ video: videoEnabled });\n    }\n  };\n\n  useEffect(() => {\n    participantRef.current = props.participants;\n  }, [props.participants]);\n\n  const updateStream = (stream) => {\n    for (let key in participantRef.current) {\n      const sender = participantRef.current[key];\n      if (sender.currentUser) continue;\n      const peerConnection = sender.peerConnection\n        .getSenders()\n        .find((s) => (s.track ? s.track.kind === \"video\" : false));\n      peerConnection.replaceTrack(stream.getVideoTracks()[0]);\n    }\n    props.setMainStream(stream);\n  };\n\n  const onScreenShareEnd = async () => {\n    const localStream = await navigator.mediaDevices.getUserMedia({\n      audio: true,\n      video: true,\n    });\n\n    localStream.getVideoTracks()[0].enabled = Object.values(\n      props.currentUser\n    )[0].video;\n\n    updateStream(localStream);\n\n    props.updateUser({ screen: false });\n  };\n\n  const onScreenClick = async () => {\n    let mediaStream;\n    if (navigator.getDisplayMedia) {\n      mediaStream = await navigator.getDisplayMedia({ video: true });\n    } else if (navigator.mediaDevices.getDisplayMedia) {\n      mediaStream = await navigator.mediaDevices.getDisplayMedia({\n        video: true,\n      });\n    } else {\n      mediaStream = await navigator.mediaDevices.getUserMedia({\n        video: { mediaSource: \"screen\" },\n      });\n    }\n\n    mediaStream.getVideoTracks()[0].onended = onScreenShareEnd;\n\n    updateStream(mediaStream);\n\n    props.updateUser({ screen: true });\n  };\n  return (\n    <div className=\"wrapper\">\n      <div className=\"main-screen\">\n        <Participants />\n      </div>\n\n      <div className=\"footer\">\n        <MeetingFooter\n          onScreenClick={onScreenClick}\n          onMicClick={onMicClick}\n          onVideoClick={onVideoClick}\n        />\n      </div>\n    </div>\n  );\n};\n\nconst mapStateToProps = (state) => {\n  return {\n    stream: state.mainStream,\n    participants: state.participants,\n    currentUser: state.currentUser,\n  };\n};\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    setMainStream: (stream) => dispatch(setMainStream(stream)),\n    updateUser: (user) => dispatch(updateUser(user)),\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(MainScreen);\n","import React, {useState} from 'react';\r\nimport { loginWithGoogle, auth, logout } from '../server/firebase';\r\nimport { useAuthState } from 'react-firebase-hooks/auth';\r\n\r\nconst AuthContext = React.createContext();\r\n\r\n\r\nconst AuthProvider = (props) => {\r\n    const [user, setUser] = useAuthState(auth);\r\n\r\n    const login = async () => {\r\n        const user = await loginWithGoogle();\r\n\r\n        if (!user) {\r\n            // TODO: Handle failed login\r\n            //setUser(false);\r\n        }\r\n\r\n        //setUser(true);\r\n    };\r\n\r\n    setTimeout(logout, 7200000);  \r\n    const value = { user, login };\r\n    return <AuthContext.Provider value={value} {...props} />;\r\n};\r\n\r\n\r\nexport { AuthContext, AuthProvider};\r\n","import React from 'react';\r\nimport { AuthContext } from '../context/auth';\r\n\r\nfunction useAuth() {\r\n    const value = React.useContext(AuthContext);\r\n\r\n    if (!value) {\r\n        throw new Error(\"AuthContext's value is undefined.\");\r\n    }\r\n\r\n    return value;\r\n}\r\n\r\nexport { useAuth };\r\n","import MainScreen from \"./components/MainScreen/MainScreen.component\";\nimport firepadRef from \"./server/firebase\";\nimport \"./App.css\";\nimport React, { useEffect} from \"react\";\nimport {getDatabase, ref, child, onValue, push, onChildAdded, onChildRemoved, onChildChanged, remove, onDisconnect} from \"firebase/database\";\nimport {\n  setMainStream,\n  addParticipant,\n  setUser,\n  removeParticipant,\n  updateParticipant,\n} from \"./store/actioncreator\";\nimport { connect } from \"react-redux\";\nimport { useAuth } from \"./hooks/useAuth\";\n\n\nfunction App(props) {\n  const room = localStorage.getItem(\"roomId\");\n  const urlTemp = window.location.pathname.split('/');\n  const urlRef = urlTemp[urlTemp.length-1];\n  if (room != urlRef){\n    window.location.href = '/';\n  }\n  const userTemp = useAuth();\n  const userName = userTemp.user.displayName;\n  const getUserStream = async () => {\n    const localStream = await navigator.mediaDevices.getUserMedia({\n      audio: true,\n      video: true,\n    });\n\n    return localStream;\n  };\n  useEffect(async () => {\n    const stream = await getUserStream();\n    stream.getVideoTracks()[0].enabled = false;\n    props.setMainStream(stream);\n\n\n    onValue(connectedRef, (snap) => {\n      if (snap.val() === true) {\n        const defaultPreference = {\n          audio: true,\n          video: false,\n          screen: false,\n        };\n        const userStatusRef = push(participantRef,{\n          userName,\n          preferences: defaultPreference,\n        });\n        props.setUser({\n          [userStatusRef.key]: { name: userName, ...defaultPreference },\n        });\n        //userStatusRef.onDisconnect().remove();   \n        onDisconnect(userStatusRef).remove();\n       } \n    });\n  }, []);\n\n  const db = getDatabase();\n  const connectedRef = ref(db, \".info/connected\");\n  const fpdRef = child(firepadRef, urlRef);\n  const participantRef = child(fpdRef, \"participants\");\n  const isUserSet = !!props.user;\n  const isStreamSet = !!props.stream;\n\n  useEffect(() => {\n    if (isStreamSet && isUserSet) {\n      onChildAdded(participantRef, (snap) => {\n        const preferenceUpdateEvent1 = child(participantRef, snap.key);\n        const preferenceUpdateEvent = child(preferenceUpdateEvent1, \"preferences\");\n        onChildChanged(preferenceUpdateEvent, (preferenceSnap) => {\n          props.updateParticipant({\n            [snap.key]: {\n              [preferenceSnap.key]: preferenceSnap.val(),\n            },\n          });\n        });\n        const { userName: name, preferences = {} } = snap.val();\n        // const audio = new Audio(notifyFile);\n        // audio.play(); /////////////////////////////////////////////////////////////////////////////////////\n        props.addParticipant({\n          [snap.key]: {\n            name,\n            ...preferences,\n          },\n        });\n      });\n      onChildRemoved(participantRef, (snap) => {\n        // const audio = new Audio(unnotifyFile);\n        // audio.play();\n        props.removeParticipant(snap.key);\n      });\n    }\n  }, [isStreamSet, isUserSet]);\n\n  return (\n    <div className=\"App\">\n      <MainScreen />\n    </div>\n  );\n}\n\nconst mapStateToProps = (state) => {\n  return {\n    stream: state.mainStream,\n    user: state.currentUser,\n  };\n};\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    setMainStream: (stream) => dispatch(setMainStream(stream)),\n    addParticipant: (user) => dispatch(addParticipant(user)),\n    setUser: (user) => dispatch(setUser(user)),\n    removeParticipant: (userId) => dispatch(removeParticipant(userId)),\n    updateParticipant: (user) => dispatch(updateParticipant(user)),\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(App);\n","import {Routes, Route, HashRouter } from 'react-router-dom';\r\nimport { AuthenticatedApp } from '../AuthenticatedApp';\r\nimport App from '../../App';\r\n\r\nfunction Router() {\r\n    return (\r\n        // <HashRouter>\r\n            <Routes>\r\n                <Route path=\"/\" element={<AuthenticatedApp />} />\r\n                <Route path=\"/room/:id\" element={<App />} />\r\n            </Routes>\r\n        // </HashRouter>\r\n    );\r\n}\r\n\r\nexport { Router };","import { useAuth } from '../../hooks/useAuth';\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { auth, logInWithEmailAndPassword } from \"../../server/firebase\";\r\nimport { useAuthState } from \"react-firebase-hooks/auth\";\r\nimport './styles.css';\r\n\r\nfunction UnauthenticatedApp() {\r\n    const { login } = useAuth();\r\n    const [email, setEmail] = useState(\"\");\r\n    const [password, setPassword] = useState(\"\");\r\n    const [user, loading, error] = useAuthState(auth);\r\n    //const navigate = useNavigate();\r\n\r\n    return (\r\n        <>\r\n            <h2 className='unauthLbl'>Необходимо произвести вход</h2>\r\n            <div>\r\n            <div className=\"login\">\r\n                <button onClick={login} className=\"login\">\r\n                    Войти с помощью Google\r\n                </button>\r\n                </div>\r\n            </div>\r\n        </>\r\n    );\r\n}\r\n\r\nexport { UnauthenticatedApp };","import { AuthenticatedApp } from './components/AuthenticatedApp';\r\nimport { Router } from './components/Router/router';\r\nimport { UnauthenticatedApp } from './components/UnauthenticatedApp';\r\nimport { useAuth } from './hooks/useAuth';\r\nimport './start.css';\r\n\r\nfunction App() {\r\n     const { user } = useAuth();\r\n\r\n\r\n    return (\r\n        <div className=\"container\">\r\n            {user ? <Router /> : <UnauthenticatedApp />}\r\n        </div>\r\n    );\r\n    // return (\r\n    //     <div className=\"container\">\r\n    //         <Router /> \r\n    //     </div>\r\n    // );\r\n\r\n}\r\n\r\nexport default App;","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import firepadRef from \"./firebase\";\nimport { store } from \"../index\";\nimport {child, onChildAdded, push, set, update} from \"firebase/database\";\nimport { useMatch } from \"react-router-dom\";\nimport React from \"react\";\n\n  // const urlTemp = window.location.pathname.split('/');\n  // const urlRef = urlTemp[urlTemp.length-1];\n  // const fpdRef = child(firepadRef, urlRef);\n  // const participantRef = child(fpdRef, \"participants\");\n  var participantRef = null;\n\nexport const updatePreference = (userId, preference) => {\n  const currentParticipantRef1 = child(participantRef, userId);\n  const currentParticipantRef = child(currentParticipantRef1, \"preferences\");\n  setTimeout(() => {\n    update(currentParticipantRef, preference);\n  });\n};\n\nexport const createOffer = async (peerConnection, receiverId, createdID) => {\n\n  const currentParticipantRef = child(participantRef, receiverId);\n  peerConnection.onicecandidate = (event) => {\n    event.candidate &&\n    push(child(currentParticipantRef, \"offerCandidates\"), { ...event.candidate.toJSON(), userId: createdID });\n      // currentParticipantRef\n      //   .child(\"offerCandidates\")\n      //   .push({ ...event.candidate.toJSON(), userId: createdID });\n  };\n\n  const offerDescription = await peerConnection.createOffer();\n  await peerConnection.setLocalDescription(offerDescription);\n\n  const offer = {\n    sdp: offerDescription.sdp,\n    type: offerDescription.type,\n    userId: createdID,\n  };\n\n  //await currentParticipantRef.child(\"offers\").push().set({ offer });\n  await set(push(child(currentParticipantRef, \"offers\")), {offer});\n};\n\nexport const initializeListensers = async (userId) => {\n     const urlTemp = window.location.pathname.split('/');\n   const urlRef = urlTemp[urlTemp.length-1];\n   const fpdRef = child(firepadRef, urlRef);\n   participantRef = child(fpdRef, \"participants\");\n  const currentUserRef = child(participantRef, userId);\n  const currenOffers = child(currentUserRef,\"offers\");\n  onChildAdded(currenOffers, async (snapshot) => {\n    const data = snapshot.val();\n    if (data?.offer) {\n      const pc =\n        store.getState().participants[data.offer.userId].peerConnection;\n      await pc.setRemoteDescription(new RTCSessionDescription(data.offer));\n      await createAnswer(data.offer.userId, userId);\n    }\n  });\n\n    onChildAdded(child(currentUserRef, \"offerCandidates\"), (snapshot) => {\n    const data = snapshot.val();\n    if (data.userId) {\n      const pc = store.getState().participants[data.userId].peerConnection;\n      pc.addIceCandidate(new RTCIceCandidate(data));\n    }\n  });\n\n  onChildAdded(child(currentUserRef, \"answers\"),(snapshot) => {\n    const data = snapshot.val();\n    if (data?.answer) {\n      const pc =\n        store.getState().participants[data.answer.userId].peerConnection;\n      const answerDescription = new RTCSessionDescription(data.answer);\n      pc.setRemoteDescription(answerDescription);\n    }\n  });\n\n  onChildAdded(child(currentUserRef, \"answerCandidates\"), (snapshot) => {\n    const data = snapshot.val();\n    if (data.userId) {\n      const pc = store.getState().participants[data.userId].peerConnection;\n      pc.addIceCandidate(new RTCIceCandidate(data));\n    }\n  });\n\n\n};\n\nconst createAnswer = async (otherUserId, userId) => {\n  const pc = store.getState().participants[otherUserId].peerConnection;\n  const participantRef1 = child(participantRef, otherUserId);\n  pc.onicecandidate = (event) => {\n    event.candidate &&\n    push(child(participantRef1, \"answerCandidates\"), { ...event.candidate.toJSON(), userId: userId });\n      // participantRef1\n      //   .child(\"answerCandidates\")\n      //   .push({ ...event.candidate.toJSON(), userId: userId });\n  };\n\n  const answerDescription = await pc.createAnswer();\n  await pc.setLocalDescription(answerDescription);\n\n  const answer = {\n    type: answerDescription.type,\n    sdp: answerDescription.sdp,\n    userId: userId,\n  };\n\n  //await participantRef1.child(\"answers\").push().set({ answer });\n  await set(push(child(participantRef1, \"answers\")), {answer});\n};\n","import {\n  SET_MAIN_STREAM,\n  ADD_PARTICIPANT,\n  SET_USER,\n  REMOVE_PARTICIPANT,\n  UPDATE_USER,\n  UPDATE_PARTICIPANT,\n} from \"./actiontypes\";\n\nimport {\n  createOffer,\n  initializeListensers,\n  updatePreference,\n} from \"../server/peerConnection\";\n\nlet defaultUserState = {\n  mainStream: null,\n  participants: {},\n  currentUser: null,\n};\n\nconst servers = {\n  iceServers: [\n    {\n      urls: [\n        \"stun:stun1.l.google.com:19302\",\n        \"stun:stun2.l.google.com:19302\",\n        \"stun:stun.l.google.com:19302\",\n        \"stun:stun3.l.google.com:19302\",\n        \"stun:stun4.l.google.com:19302\",\n        \"stun:stun.services.mozilla.com\",\n      ],\n    },\n  ],\n  iceCandidatePoolSize: 10,\n};\n\nconst generateColor = () =>\n  \"#\" + Math.floor(Math.random() * 16777215).toString(16);\n\nexport const userReducer = (state = defaultUserState, action) => {\n  if (action.type === SET_MAIN_STREAM) {\n    let payload = action.payload;\n    state = { ...state, ...payload };\n    return state;\n  } else if (action.type === ADD_PARTICIPANT) {\n    let payload = action.payload;\n    const currentUserId = Object.keys(state.currentUser)[0];\n    const newUserId = Object.keys(payload.newUser)[0];\n    if (state.mainStream && currentUserId !== newUserId) {\n      payload.newUser = addConnection(\n        payload.newUser,\n        state.currentUser,\n        state.mainStream\n      );\n    }\n\n    if (currentUserId === newUserId)\n      payload.newUser[newUserId].currentUser = true;\n    payload.newUser[newUserId].avatarColor = generateColor();\n    let participants = { ...state.participants, ...payload.newUser };\n    state = { ...state, participants };\n    return state;\n  } else if (action.type === SET_USER) {\n    let payload = action.payload;\n    let participants = { ...state.participants };\n    const userId = Object.keys(payload.currentUser)[0];\n    payload.currentUser[userId].avatarColor = generateColor();\n    initializeListensers(userId);\n    state = { ...state, currentUser: { ...payload.currentUser }, participants };\n    return state;\n  } else if (action.type === REMOVE_PARTICIPANT) {\n    let payload = action.payload;\n    let participants = { ...state.participants };\n    delete participants[payload.id];\n    state = { ...state, participants };\n    return state;\n  } else if (action.type === UPDATE_USER) {\n    let payload = action.payload;\n    const userId = Object.keys(state.currentUser)[0];\n    updatePreference(userId, payload.currentUser);\n    state.currentUser[userId] = {\n      ...state.currentUser[userId],\n      ...payload.currentUser,\n    };\n    state = {\n      ...state,\n      currentUser: { ...state.currentUser },\n    };\n    return state;\n  } else if (action.type === UPDATE_PARTICIPANT) {\n    let payload = action.payload;\n    const newUserId = Object.keys(payload.newUser)[0];\n\n    payload.newUser[newUserId] = {\n      ...state.participants[newUserId],\n      ...payload.newUser[newUserId],\n    };\n    let participants = { ...state.participants, ...payload.newUser };\n    state = { ...state, participants };\n    return state;\n  }\n  return state;\n};\n\nconst addConnection = (newUser, currentUser, stream) => {\n  const peerConnection = new RTCPeerConnection(servers);\n  stream.getTracks().forEach((track) => {\n    peerConnection.addTrack(track, stream);\n  });\n  const newUserId = Object.keys(newUser)[0];\n  const currentUserId = Object.keys(currentUser)[0];\n\n  const offerIds = [newUserId, currentUserId].sort((a, b) =>\n    a.localeCompare(b)\n  );\n\n  newUser[newUserId].peerConnection = peerConnection;\n  if (offerIds[0] !== currentUserId)\n    createOffer(peerConnection, offerIds[0], offerIds[1]);\n  return newUser;\n};\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport Start from \"./start\";\nimport reportWebVitals from \"./reportWebVitals\";\nimport { Provider } from \"react-redux\";\nimport { createStore } from \"redux\";\nimport { userReducer } from \"./store/reducer\";\nimport { AuthProvider } from \"./context/auth\";\nimport { HashRouter } from \"react-router-dom\";\n\nexport const store = createStore(userReducer);\nReactDOM.render(\n  <React.StrictMode>\n    <Provider store={store}>\n      <AuthProvider>\n        <HashRouter>\n        <Start />\n        </HashRouter>\n      </AuthProvider>\n    </Provider>\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}