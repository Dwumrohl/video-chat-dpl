{"version":3,"sources":["server/firebase.js","components/AuthenticatedApp/index.jsx","context/auth.js","hooks/useAuth.js","components/UnauthenticatedApp/index.jsx","start.js","reportWebVitals.js","store/actiontypes.js","server/peerConnection.js","store/reducer.js","components/MeetingFooter/MeetingFooter.component.js","components/Shared/Card/Card.component.js","components/Participants/Participant/Participant.component.js","components/Participants/Participants.component.js","store/actioncreator.js","components/MainScreen/MainScreen.component.js","App.js","index.js"],"names":["app","initializeApp","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","databaseURL","auth","getAuth","db","getFirestore","firepadRef","ref","getDatabase","loginWithGoogle","a","provider","GoogleAuthProvider","signInWithPopup","user","q","query","collection","where","uid","getDocs","docs","length","addDoc","name","displayName","authProvider","email","code","console","error","onAuthStateChanged","logout","signOut","AuthenticatedApp","useState","room","setRoom","romTemp","className","onClick","roomId","URLSearchParams","window","location","search","get","child","push","key","roomTemp","localStorage","setItem","href","onSubmit","event","preventDefault","log","type","value","onChange","e","target","required","placeholder","AuthContext","React","createContext","AuthProvider","props","useAuthState","login","setTimeout","Provider","useAuth","useContext","Error","UnauthenticatedApp","App","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","SET_MAIN_STREAM","ADD_PARTICIPANT","REMOVE_PARTICIPANT","SET_USER","UPDATE_USER","UPDATE_PARTICIPANT","participantRef","updatePreference","userId","preference","currentParticipantRef1","currentParticipantRef","update","createOffer","peerConnection","receiverId","createdID","onicecandidate","candidate","toJSON","offerDescription","setLocalDescription","offer","sdp","set","initializeListensers","urlTemp","pathname","split","urlRef","fpdRef","currentUserRef","currenOffers","onChildAdded","snapshot","data","val","pc","store","getState","participants","setRemoteDescription","RTCSessionDescription","createAnswer","addIceCandidate","RTCIceCandidate","answer","answerDescription","otherUserId","participantRef1","defaultUserState","mainStream","currentUser","servers","iceServers","urls","iceCandidatePoolSize","generateColor","Math","floor","random","toString","addConnection","newUser","stream","RTCPeerConnection","getTracks","forEach","track","addTrack","newUserId","Object","keys","currentUserId","offerIds","sort","b","localeCompare","MeetingFooter","mic","video","screen","streamState","setStreamState","setScreenState","isEnabled","currentState","useEffect","onMicClick","onVideoClick","data-tip","icon","faMicrophone","faMicrophoneSlash","title","faVideo","faVideoSlash","onScreenClick","disabled","faDesktop","faSignOutAlt","Card","children","Participant","curentIndex","currentParticipant","hideVideo","videoRef","showAvatar","id","autoPlay","playsInline","audio","style","background","avatarColor","connect","state","useRef","participantKey","current","srcObject","muted","values","gridCol","gridColSize","gridRowSize","ceil","screenPresenter","find","element","map","index","remoteStream","MediaStream","ontrack","streams","videElement","document","getElementById","setMainStream","payload","dispatch","updateUser","updateStream","sender","getSenders","s","kind","replaceTrack","getVideoTracks","onScreenShareEnd","navigator","mediaDevices","getUserMedia","localStream","enabled","getDisplayMedia","mediaStream","mediaSource","onended","micEnabled","getAudioTracks","videoEnabled","addParticipant","setUser","removeParticipant","updateParticipant","getItem","userName","getUserStream","onValue","connectedRef","snap","defaultPreference","userStatusRef","preferences","onDisconnect","remove","isUserSet","isStreamSet","preferenceUpdateEvent1","preferenceUpdateEvent","onChildChanged","preferenceSnap","onChildRemoved","createStore","action","ReactDOM","render","StrictMode","path","exact"],"mappings":"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","file":"static/js/main.aa425ec4.chunk.js","sourcesContent":["import { initializeApp } from \"firebase/app\";\nimport { GoogleAuthProvider, signInWithPopup, getAuth, signOut, onAuthStateChanged} from 'firebase/auth';\nimport { getFirestore } from 'firebase/firestore';\nimport { getDatabase, push, ref, child, set} from \"firebase/database\";\nimport { collection, addDoc,getDocs,\n    query, where } from 'firebase/firestore';\n\nvar firebaseConfig = {\n  apiKey: \"AIzaSyCZzeoeLPf9RygQgYkvEI6q5c490KYeChY\",\n  authDomain: \"test-video-chat-4979b.firebaseapp.com\",\n  projectId: \"test-video-chat-4979b\",\n  storageBucket: \"test-video-chat-4979b.appspot.com\",\n  messagingSenderId: \"249820721403\",\n  appId: \"1:249820721403:web:9ce311e53144626720c05e\",\n  databaseURL: \"https://test-video-chat-4979b-default-rtdb.europe-west1.firebasedatabase.app/\"\n};\n// Initialize Firebase\n\nconst app = initializeApp(firebaseConfig);\nconst auth = getAuth();\nconst db = getFirestore(app);\n\n\nvar firepadRef = ref(getDatabase());\n//export const userName = prompt(\"What's your name?\");\nexport const userName = \"Олег\"; ////\n\nexport function roomTemp(){\n  const urlparams = new URLSearchParams(window.location.search);\n  const roomId = urlparams.get(\"id\");\n  \n  if (roomId) {\n    firepadRef = child(firepadRef, roomId);\n  } else {\n    //var tempRef = push(firepadRef);\n    firepadRef = push(firepadRef);\n    //window.history.replaceState(null, \"Meet\", firepadRef.key);\n  }\n  return firepadRef.key;\n}\n\n\nasync function loginWithGoogle() {\n  try {\n      const provider = new GoogleAuthProvider();       \n\n      const { user } = await signInWithPopup(auth, provider);\n      const q = query(collection(db, \"users\"), where(\"uid\", \"==\", user.uid));\n\n      const docs = await getDocs(q);\n      if (docs.docs.length === 0) {\n\n          await addDoc(collection(db, \"users\"), {\n      uid: user.uid,\n      name: user.displayName,\n      authProvider: \"google\",\n      email: user.email,\n    });\n  }\n      return { uid: user.uid, displayName: user.displayName };\n  } catch (error) {\n      if (error.code !== 'auth/cancelled-popup-request') {\n          console.error(error);\n      }\n\n      return null;\n  }\n}\n\nonAuthStateChanged(auth, (user) => {\n  if (user) {\n    // User is signed in.\n    // ...\n  } else {\n    // User is not signed in.\n    // ...\n  }\n});\n\nconst logout = () => {\n  signOut(auth);\n};\n\n\nexport default firepadRef;\nexport {loginWithGoogle, auth, db, logout};\n","import { userName, logout, roomTemp} from '../../server/firebase';\r\nimport {Link} from 'react-router-dom';\r\nimport React, {useState} from \"react\";\r\nimport \"./index.css\";\r\n\r\n// import { Landing } from '../Landing';\r\n// import { ChatRoom } from '../ChatRoom';\r\n\r\n\r\nfunction AuthenticatedApp() {\r\n    const [room, setRoom] = useState(\"\");\r\n    var romTemp = null;\r\n    //window.room = romTemp; \r\n    function testRoom(){\r\n        romTemp = roomTemp();\r\n        localStorage.setItem(\"roomId\",romTemp);\r\n        window.location.href='/video-chat-dpl/room/'+romTemp;\r\n    }\r\n\r\n    const handleSubmit =  (event) => {\r\n        event.preventDefault();\r\n        localStorage.setItem(\"roomId\",room);\r\n        window.location.href='/video-chat-dpl/room/' + room;\r\n        console.log(room);\r\n    }\r\n    return (\r\n        <div className='main'>\r\n        <div className='inner'>\r\n            <h3 className='welcome'>Добро пожаловать в приложение для видеосвязи!</h3>\r\n            <div className='divCreate'>\r\n                <button className=\"btns\" onClick={testRoom}>Создать комнату</button>\r\n            </div>\r\n            <div className='forma'>\r\n            <form onSubmit={handleSubmit}>\r\n                <label className='labelRoom'>Введите номер комнаты:</label>\r\n                <div className='inputRoom'>\r\n                <input\r\n                type=\"text\"\r\n                value={room}\r\n                onChange={(e) => setRoom(e.target.value)}\r\n                required\r\n                placeholder='Номер...'\r\n                className='inputRoom'></input>\r\n                </div>\r\n                <input className=\"btns\" type=\"submit\" value=\"Войти\"/>\r\n            </form>\r\n            </div>\r\n            <div className='divOut'>\r\n                <button className=\"leaveBtn\" onClick={logout}>Выход из аккаунта</button>\r\n            </div>\r\n        </div>\r\n        </div>\r\n        \r\n    );\r\n}\r\n\r\n\r\nexport { AuthenticatedApp };","import React, {useState} from 'react';\r\nimport { loginWithGoogle, auth, logout } from '../server/firebase';\r\nimport { useAuthState } from 'react-firebase-hooks/auth';\r\n\r\nconst AuthContext = React.createContext();\r\n\r\n\r\nconst AuthProvider = (props) => {\r\n    const [user, setUser] = useAuthState(auth);\r\n\r\n    const login = async () => {\r\n        const user = await loginWithGoogle();\r\n\r\n        if (!user) {\r\n            // TODO: Handle failed login\r\n            //setUser(false);\r\n        }\r\n\r\n        //setUser(true);\r\n    };\r\n\r\n    setTimeout(logout, 7200000);  \r\n    const value = { user, login };\r\n    return <AuthContext.Provider value={value} {...props} />;\r\n};\r\n\r\n\r\nexport { AuthContext, AuthProvider};\r\n","import React from 'react';\r\nimport { AuthContext } from '../context/auth';\r\n\r\nfunction useAuth() {\r\n    const value = React.useContext(AuthContext);\r\n\r\n    if (!value) {\r\n        throw new Error(\"AuthContext's value is undefined.\");\r\n    }\r\n\r\n    return value;\r\n}\r\n\r\nexport { useAuth };\r\n","import { useAuth } from '../../hooks/useAuth';\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { auth, logInWithEmailAndPassword } from \"../../server/firebase\";\r\nimport { useAuthState } from \"react-firebase-hooks/auth\";\r\nimport './styles.css';\r\n\r\nfunction UnauthenticatedApp() {\r\n    const { login } = useAuth();\r\n    const [email, setEmail] = useState(\"\");\r\n    const [password, setPassword] = useState(\"\");\r\n    const [user, loading, error] = useAuthState(auth);\r\n    //const navigate = useNavigate();\r\n\r\n    return (\r\n        <>\r\n            <h2 className='unauthLbl'>Необходимо произвести вход</h2>\r\n            <div>\r\n            <div className=\"login\">\r\n                <button onClick={login} className=\"login\">\r\n                    Войти с помощью Google\r\n                </button>\r\n                </div>\r\n            </div>\r\n        </>\r\n    );\r\n}\r\n\r\nexport { UnauthenticatedApp };","import { AuthenticatedApp } from './components/AuthenticatedApp';\r\nimport { UnauthenticatedApp } from './components/UnauthenticatedApp';\r\nimport { useAuth } from './hooks/useAuth';\r\nimport './start.css';\r\n\r\nfunction App() {\r\n     const { user } = useAuth();\r\n\r\n\r\n    return (\r\n        <div className=\"container\">\r\n            {user ? <AuthenticatedApp /> : <UnauthenticatedApp />}\r\n        </div>\r\n    );\r\n\r\n}\r\n\r\nexport default App;","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","export const SET_MAIN_STREAM = \"SET_MAIN_STREAM\";\nexport const ADD_PARTICIPANT = \"ADD_PARTICIPANT\";\nexport const REMOVE_PARTICIPANT = \"REMOVE_PARTICIPANT\";\nexport const SET_USER = \"SET_USER\";\nexport const UPDATE_USER = \"UPDATE_USER\";\nexport const UPDATE_PARTICIPANT = \"UPDATE_PARTICIPANT\";\n","import firepadRef from \"./firebase\";\nimport { store } from \"../index\";\nimport {child, onChildAdded, push, set, update} from \"firebase/database\";\nimport { useMatch } from \"react-router-dom\";\nimport React from \"react\";\n\n  // const urlTemp = window.location.pathname.split('/');\n  // const urlRef = urlTemp[urlTemp.length-1];\n  // const fpdRef = child(firepadRef, urlRef);\n  // const participantRef = child(fpdRef, \"participants\");\n  var participantRef = null;\n\nexport const updatePreference = (userId, preference) => {\n  const currentParticipantRef1 = child(participantRef, userId);\n  const currentParticipantRef = child(currentParticipantRef1, \"preferences\");\n  setTimeout(() => {\n    update(currentParticipantRef, preference);\n  });\n};\n\nexport const createOffer = async (peerConnection, receiverId, createdID) => {\n\n  const currentParticipantRef = child(participantRef, receiverId);\n  peerConnection.onicecandidate = (event) => {\n    event.candidate &&\n    push(child(currentParticipantRef, \"offerCandidates\"), { ...event.candidate.toJSON(), userId: createdID });\n      // currentParticipantRef\n      //   .child(\"offerCandidates\")\n      //   .push({ ...event.candidate.toJSON(), userId: createdID });\n  };\n\n  const offerDescription = await peerConnection.createOffer();\n  await peerConnection.setLocalDescription(offerDescription);\n\n  const offer = {\n    sdp: offerDescription.sdp,\n    type: offerDescription.type,\n    userId: createdID,\n  };\n\n  //await currentParticipantRef.child(\"offers\").push().set({ offer });\n  await set(push(child(currentParticipantRef, \"offers\")), {offer});\n};\n\nexport const initializeListensers = async (userId) => {\n     const urlTemp = window.location.pathname.split('/');\n   const urlRef = urlTemp[urlTemp.length-1];\n   const fpdRef = child(firepadRef, urlRef);\n   participantRef = child(fpdRef, \"participants\");\n  const currentUserRef = child(participantRef, userId);\n  const currenOffers = child(currentUserRef,\"offers\");\n  onChildAdded(currenOffers, async (snapshot) => {\n    const data = snapshot.val();\n    if (data?.offer) {\n      const pc =\n        store.getState().participants[data.offer.userId].peerConnection;\n      await pc.setRemoteDescription(new RTCSessionDescription(data.offer));\n      await createAnswer(data.offer.userId, userId);\n    }\n  });\n\n    onChildAdded(child(currentUserRef, \"offerCandidates\"), (snapshot) => {\n    const data = snapshot.val();\n    if (data.userId) {\n      const pc = store.getState().participants[data.userId].peerConnection;\n      pc.addIceCandidate(new RTCIceCandidate(data));\n    }\n  });\n\n  onChildAdded(child(currentUserRef, \"answers\"),(snapshot) => {\n    const data = snapshot.val();\n    if (data?.answer) {\n      const pc =\n        store.getState().participants[data.answer.userId].peerConnection;\n      const answerDescription = new RTCSessionDescription(data.answer);\n      pc.setRemoteDescription(answerDescription);\n    }\n  });\n\n  onChildAdded(child(currentUserRef, \"answerCandidates\"), (snapshot) => {\n    const data = snapshot.val();\n    if (data.userId) {\n      const pc = store.getState().participants[data.userId].peerConnection;\n      pc.addIceCandidate(new RTCIceCandidate(data));\n    }\n  });\n\n\n};\n\nconst createAnswer = async (otherUserId, userId) => {\n  const pc = store.getState().participants[otherUserId].peerConnection;\n  const participantRef1 = child(participantRef, otherUserId);\n  pc.onicecandidate = (event) => {\n    event.candidate &&\n    push(child(participantRef1, \"answerCandidates\"), { ...event.candidate.toJSON(), userId: userId });\n      // participantRef1\n      //   .child(\"answerCandidates\")\n      //   .push({ ...event.candidate.toJSON(), userId: userId });\n  };\n\n  const answerDescription = await pc.createAnswer();\n  await pc.setLocalDescription(answerDescription);\n\n  const answer = {\n    type: answerDescription.type,\n    sdp: answerDescription.sdp,\n    userId: userId,\n  };\n\n  //await participantRef1.child(\"answers\").push().set({ answer });\n  await set(push(child(participantRef1, \"answers\")), {answer});\n};\n","import {\n  SET_MAIN_STREAM,\n  ADD_PARTICIPANT,\n  SET_USER,\n  REMOVE_PARTICIPANT,\n  UPDATE_USER,\n  UPDATE_PARTICIPANT,\n} from \"./actiontypes\";\n\nimport {\n  createOffer,\n  initializeListensers,\n  updatePreference,\n} from \"../server/peerConnection\";\n\nlet defaultUserState = {\n  mainStream: null,\n  participants: {},\n  currentUser: null,\n};\n\nconst servers = {\n  iceServers: [\n    {\n      urls: [\n        \"stun:stun1.l.google.com:19302\",\n        \"stun:stun2.l.google.com:19302\",\n        \"stun:stun.l.google.com:19302\",\n        \"stun:stun3.l.google.com:19302\",\n        \"stun:stun4.l.google.com:19302\",\n        \"stun:stun.services.mozilla.com\",\n      ],\n    },\n  ],\n  iceCandidatePoolSize: 10,\n};\n\nconst generateColor = () =>\n  \"#\" + Math.floor(Math.random() * 16777215).toString(16);\n\nexport const userReducer = (state = defaultUserState, action) => {\n  if (action.type === SET_MAIN_STREAM) {\n    let payload = action.payload;\n    state = { ...state, ...payload };\n    return state;\n  } else if (action.type === ADD_PARTICIPANT) {\n    let payload = action.payload;\n    const currentUserId = Object.keys(state.currentUser)[0];\n    const newUserId = Object.keys(payload.newUser)[0];\n    if (state.mainStream && currentUserId !== newUserId) {\n      payload.newUser = addConnection(\n        payload.newUser,\n        state.currentUser,\n        state.mainStream\n      );\n    }\n\n    if (currentUserId === newUserId)\n      payload.newUser[newUserId].currentUser = true;\n    payload.newUser[newUserId].avatarColor = generateColor();\n    let participants = { ...state.participants, ...payload.newUser };\n    state = { ...state, participants };\n    return state;\n  } else if (action.type === SET_USER) {\n    let payload = action.payload;\n    let participants = { ...state.participants };\n    const userId = Object.keys(payload.currentUser)[0];\n    payload.currentUser[userId].avatarColor = generateColor();\n    initializeListensers(userId);\n    state = { ...state, currentUser: { ...payload.currentUser }, participants };\n    return state;\n  } else if (action.type === REMOVE_PARTICIPANT) {\n    let payload = action.payload;\n    let participants = { ...state.participants };\n    delete participants[payload.id];\n    state = { ...state, participants };\n    return state;\n  } else if (action.type === UPDATE_USER) {\n    let payload = action.payload;\n    const userId = Object.keys(state.currentUser)[0];\n    updatePreference(userId, payload.currentUser);\n    state.currentUser[userId] = {\n      ...state.currentUser[userId],\n      ...payload.currentUser,\n    };\n    state = {\n      ...state,\n      currentUser: { ...state.currentUser },\n    };\n    return state;\n  } else if (action.type === UPDATE_PARTICIPANT) {\n    let payload = action.payload;\n    const newUserId = Object.keys(payload.newUser)[0];\n\n    payload.newUser[newUserId] = {\n      ...state.participants[newUserId],\n      ...payload.newUser[newUserId],\n    };\n    let participants = { ...state.participants, ...payload.newUser };\n    state = { ...state, participants };\n    return state;\n  }\n  return state;\n};\n\nconst addConnection = (newUser, currentUser, stream) => {\n  const peerConnection = new RTCPeerConnection(servers);\n  stream.getTracks().forEach((track) => {\n    peerConnection.addTrack(track, stream);\n  });\n  const newUserId = Object.keys(newUser)[0];\n  const currentUserId = Object.keys(currentUser)[0];\n\n  const offerIds = [newUserId, currentUserId].sort((a, b) =>\n    a.localeCompare(b)\n  );\n\n  newUser[newUserId].peerConnection = peerConnection;\n  if (offerIds[0] !== currentUserId)\n    createOffer(peerConnection, offerIds[0], offerIds[1]);\n  return newUser;\n};\n","import React, { useEffect, useState } from \"react\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport {\n  faMicrophone,\n  faVideo,\n  faDesktop,\n  faVideoSlash,\n  faMicrophoneSlash,\n  faSignOutAlt,\n} from \"@fortawesome/free-solid-svg-icons\";\nimport ReactTooltip from \"react-tooltip\";\nimport \"./MeetingFooter.css\";\nconst MeetingFooter = (props) => {\n  const [streamState, setStreamState] = useState({\n    mic: true,\n    video: false,\n    screen: false,\n  });\n  const micClick = () => {\n    setStreamState((currentState) => {\n      return {\n        ...currentState,\n        mic: !currentState.mic,\n      };\n    });\n  };\n\n  const onVideoClick = () => {\n    setStreamState((currentState) => {\n      return {\n        ...currentState,\n        video: !currentState.video,\n      };\n    });\n  };\n\n  const onLeaveClick = () => {\n    //window.location.href = \"/\";\n  }\n\n  const onScreenClick = () => {\n    props.onScreenClick(setScreenState);\n  };\n\n  const setScreenState = (isEnabled) => {\n    setStreamState((currentState) => {\n      return {\n        ...currentState,\n        screen: isEnabled,\n      };\n    });\n  };\n  useEffect(() => {\n    props.onMicClick(streamState.mic);\n  }, [streamState.mic]);\n  useEffect(() => {\n    props.onVideoClick(streamState.video);\n  }, [streamState.video]);\n  return (\n    <div className=\"meeting-footer\">\n      <div\n        className={\"meeting-icons \" + (!streamState.mic ? \"active\" : \"\")}\n        data-tip={streamState.mic ? \"Выключить микрофон\" : \"Включить микрофон\"}\n        onClick={micClick}\n      >\n        <FontAwesomeIcon\n          icon={!streamState.mic ? faMicrophoneSlash : faMicrophone}\n          title=\"Mute\"\n        />\n      </div>\n      <div\n        className={\"meeting-icons \" + (!streamState.video ? \"active\" : \"\")}\n        data-tip={streamState.video ? \"Выключить камеру\" : \"Включить камеру\"}\n        onClick={onVideoClick}\n      >\n        <FontAwesomeIcon icon={!streamState.video ? faVideoSlash : faVideo} />\n      </div>\n      <div\n        className=\"meeting-icons\"\n        data-tip=\"Демонстрация экрана\"\n        onClick={onScreenClick}\n        disabled={streamState.screen}\n      >\n        <FontAwesomeIcon icon={faDesktop} />\n      </div>\n      <div \n      onClick={onLeaveClick}\n      className=\"meeting-icons\"\n      data-tip=\"Выйти\"\n      >\n          <FontAwesomeIcon icon={faSignOutAlt} />\n      </div>\n      <ReactTooltip />\n    </div>\n  );\n};\n\nexport default MeetingFooter;\n","import React from \"react\";\nimport \"./Card.css\";\n\nconst Card = (props) => {\n  return <div className=\"card\">{props.children}</div>;\n};\n\nexport default Card;\n","import React from \"react\";\nimport Card from \"../../Shared/Card/Card.component\";\nimport { faMicrophoneSlash } from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport \"./Participant.css\";\n\nexport const Participant = (props) => {\n  const {\n    curentIndex,\n    currentParticipant,\n    hideVideo,\n    videoRef,\n    showAvatar,\n    currentUser,\n  } = props;\n  if (!currentParticipant) return <></>;\n  return (\n    <div className={`participant ${hideVideo ? \"hide\" : \"\"}`}>\n      <Card>\n        <video\n          ref={videoRef}\n          className=\"video\"\n          id={`participantVideo${curentIndex}`}\n          autoPlay\n          playsInline\n        ></video>\n        {!currentParticipant.audio && (\n          <FontAwesomeIcon\n            className=\"muted\"\n            icon={faMicrophoneSlash}\n            title=\"Muted\"\n          />\n        )}\n        {showAvatar && (\n          <div\n            style={{ background: currentParticipant.avatarColor }}\n            className=\"avatar\"\n          >\n            {currentParticipant.name[0]}\n          </div>\n        )}\n        <div className=\"name\">\n          {currentParticipant.name}\n          {currentUser ? \"(Вы)\" : \"\"}\n        </div>\n      </Card>\n    </div>\n  );\n};\n","import React, { useEffect, useRef } from \"react\";\nimport \"./Participants.css\";\nimport { connect } from \"react-redux\";\nimport { Participant } from \"./Participant/Participant.component\";\n\nconst Participants = (props) => {\n  const videoRef = useRef(null);\n  let participantKey = Object.keys(props.participants);\n  useEffect(() => {\n    if (videoRef.current) {\n      videoRef.current.srcObject = props.stream;\n      videoRef.current.muted = true;\n    }\n  }, [props.currentUser, props.stream]);\n\n  const currentUser = props.currentUser\n    ? Object.values(props.currentUser)[0]\n    : null;\n\n  let gridCol =\n    participantKey.length === 1 ? 1 : participantKey.length <= 4 ? 2 : 4;\n  const gridColSize = participantKey.length <= 4 ? 1 : 2;\n  let gridRowSize =\n    participantKey.length <= 4\n      ? participantKey.length\n      : Math.ceil(participantKey.length / 2);\n\n  const screenPresenter = participantKey.find((element) => {\n    const currentParticipant = props.participants[element];\n    return currentParticipant.screen;\n  });\n\n  if (screenPresenter) {\n    gridCol = 1;\n    gridRowSize = 2;\n  }\n  const participants = participantKey.map((element, index) => {\n    const currentParticipant = props.participants[element];\n    const isCurrentUser = currentParticipant.currentUser;\n    if (isCurrentUser) {\n      return null;\n    }\n    const pc = currentParticipant.peerConnection;\n    const remoteStream = new MediaStream();\n    let curentIndex = index;\n    if (pc) {\n      pc.ontrack = (event) => {\n        event.streams[0].getTracks().forEach((track) => {\n          remoteStream.addTrack(track);\n        });\n        const videElement = document.getElementById(\n          `participantVideo${curentIndex}`\n        );\n        if (videElement) videElement.srcObject = remoteStream;\n      };\n    }\n\n    return (\n      <Participant\n        key={curentIndex}\n        currentParticipant={currentParticipant}\n        curentIndex={curentIndex}\n        hideVideo={screenPresenter && screenPresenter !== element}\n        showAvatar={\n          !currentParticipant.video &&\n          !currentParticipant.screen &&\n          currentParticipant.name\n        }\n      />\n    );\n  });\n  return (\n    <div\n      style={{\n        \"--grid-size\": gridCol,\n        \"--grid-col-size\": gridColSize,\n        \"--grid-row-size\": gridRowSize,\n      }}\n      className={`participants`}\n    >\n      {participants}\n      <Participant\n        currentParticipant={currentUser}\n        curentIndex={participantKey.length}\n        hideVideo={screenPresenter && !currentUser.screen}\n        videoRef={videoRef}\n        showAvatar={currentUser && !currentUser.video && !currentUser.screen}\n        currentUser={true}\n      />\n    </div>\n  );\n};\n\nconst mapStateToProps = (state) => {\n  return {\n    participants: state.participants,\n    currentUser: state.currentUser,\n    stream: state.mainStream,\n  };\n};\n\nexport default connect(mapStateToProps)(Participants);\n","import {\n  SET_MAIN_STREAM,\n  ADD_PARTICIPANT,\n  SET_USER,\n  REMOVE_PARTICIPANT,\n  UPDATE_USER,\n  UPDATE_PARTICIPANT,\n} from \"./actiontypes\";\n\nexport const setMainStream = (stream) => {\n  return {\n    type: SET_MAIN_STREAM,\n    payload: {\n      mainStream: stream,\n    },\n  };\n};\n\nexport const setUser = (user) => {\n  return {\n    type: SET_USER,\n    payload: {\n      currentUser: user,\n    },\n  };\n};\n\nexport const addParticipant = (user) => {\n  return {\n    type: ADD_PARTICIPANT,\n    payload: {\n      newUser: user,\n    },\n  };\n};\n\nexport const updateUser = (user) => {\n  return {\n    type: UPDATE_USER,\n    payload: {\n      currentUser: user,\n    },\n  };\n};\n\nexport const updateParticipant = (user) => {\n  return {\n    type: UPDATE_PARTICIPANT,\n    payload: {\n      newUser: user,\n    },\n  };\n};\n\nexport const removeParticipant = (userId) => {\n  return {\n    type: REMOVE_PARTICIPANT,\n    payload: {\n      id: userId,\n    },\n  };\n};\n","import React, { useRef, useEffect } from \"react\";\nimport MeetingFooter from \"../MeetingFooter/MeetingFooter.component\";\nimport Participants from \"../Participants/Participants.component\";\nimport \"./MainScreen.css\";\nimport { connect } from \"react-redux\";\nimport { setMainStream, updateUser } from \"../../store/actioncreator\";\n\nconst MainScreen = (props) => {\n  const participantRef = useRef(props.participants);\n\n  const onMicClick = (micEnabled) => {\n    if (micEnabled){\n      // const audio = new Audio(unmuteSound);\n      //   audio.play()\n    }else {\n      // const audio = new Audio(muteSound);\n      //   audio.play()\n    }\n    if (props.stream) {\n      props.stream.getAudioTracks()[0].enabled = micEnabled;\n      props.updateUser({ audio: micEnabled });\n    }\n  };\n  const onVideoClick = (videoEnabled) => {\n    if (props.stream) {\n      props.stream.getVideoTracks()[0].enabled = videoEnabled;\n      props.updateUser({ video: videoEnabled });\n    }\n  };\n\n  useEffect(() => {\n    participantRef.current = props.participants;\n  }, [props.participants]);\n\n  const updateStream = (stream) => {\n    for (let key in participantRef.current) {\n      const sender = participantRef.current[key];\n      if (sender.currentUser) continue;\n      const peerConnection = sender.peerConnection\n        .getSenders()\n        .find((s) => (s.track ? s.track.kind === \"video\" : false));\n      peerConnection.replaceTrack(stream.getVideoTracks()[0]);\n    }\n    props.setMainStream(stream);\n  };\n\n  const onScreenShareEnd = async () => {\n    const localStream = await navigator.mediaDevices.getUserMedia({\n      audio: true,\n      video: true,\n    });\n\n    localStream.getVideoTracks()[0].enabled = Object.values(\n      props.currentUser\n    )[0].video;\n\n    updateStream(localStream);\n\n    props.updateUser({ screen: false });\n  };\n\n  const onScreenClick = async () => {\n    let mediaStream;\n    if (navigator.getDisplayMedia) {\n      mediaStream = await navigator.getDisplayMedia({ video: true });\n    } else if (navigator.mediaDevices.getDisplayMedia) {\n      mediaStream = await navigator.mediaDevices.getDisplayMedia({\n        video: true,\n      });\n    } else {\n      mediaStream = await navigator.mediaDevices.getUserMedia({\n        video: { mediaSource: \"screen\" },\n      });\n    }\n\n    mediaStream.getVideoTracks()[0].onended = onScreenShareEnd;\n\n    updateStream(mediaStream);\n\n    props.updateUser({ screen: true });\n  };\n  return (\n    <div className=\"wrapper\">\n      <div className=\"main-screen\">\n        <Participants />\n      </div>\n\n      <div className=\"footer\">\n        <MeetingFooter\n          onScreenClick={onScreenClick}\n          onMicClick={onMicClick}\n          onVideoClick={onVideoClick}\n        />\n      </div>\n    </div>\n  );\n};\n\nconst mapStateToProps = (state) => {\n  return {\n    stream: state.mainStream,\n    participants: state.participants,\n    currentUser: state.currentUser,\n  };\n};\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    setMainStream: (stream) => dispatch(setMainStream(stream)),\n    updateUser: (user) => dispatch(updateUser(user)),\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(MainScreen);\n","import MainScreen from \"./components/MainScreen/MainScreen.component\";\nimport firepadRef from \"./server/firebase\";\nimport \"./App.css\";\nimport React, { useEffect} from \"react\";\nimport {getDatabase, ref, child, onValue, push, onChildAdded, onChildRemoved, onChildChanged, remove, onDisconnect} from \"firebase/database\";\nimport {\n  setMainStream,\n  addParticipant,\n  setUser,\n  removeParticipant,\n  updateParticipant,\n} from \"./store/actioncreator\";\nimport { connect } from \"react-redux\";\nimport { useAuth } from \"./hooks/useAuth\";\n\n\nfunction App(props) {\n  const room = localStorage.getItem(\"roomId\");\n  const urlTemp = window.location.pathname.split('/');\n  const urlRef = urlTemp[urlTemp.length-1];\n  // if (room != urlRef){\n  //   window.location.href = '/';\n  // }\n  const userTemp = useAuth();\n  const userName = userTemp.user.displayName;\n  const getUserStream = async () => {\n    const localStream = await navigator.mediaDevices.getUserMedia({\n      audio: true,\n      video: true,\n    });\n\n    return localStream;\n  };\n  useEffect(async () => {\n    const stream = await getUserStream();\n    stream.getVideoTracks()[0].enabled = false;\n    props.setMainStream(stream);\n\n\n    onValue(connectedRef, (snap) => {\n      if (snap.val() === true) {\n        const defaultPreference = {\n          audio: true,\n          video: false,\n          screen: false,\n        };\n        const userStatusRef = push(participantRef,{\n          userName,\n          preferences: defaultPreference,\n        });\n        props.setUser({\n          [userStatusRef.key]: { name: userName, ...defaultPreference },\n        });\n        //userStatusRef.onDisconnect().remove();   \n        onDisconnect(userStatusRef).remove();\n       } \n    });\n  }, []);\n\n  const db = getDatabase();\n  const connectedRef = ref(db, \".info/connected\");\n  const fpdRef = child(firepadRef, urlRef);\n  const participantRef = child(fpdRef, \"participants\");\n  const isUserSet = !!props.user;\n  const isStreamSet = !!props.stream;\n\n  useEffect(() => {\n    if (isStreamSet && isUserSet) {\n      onChildAdded(participantRef, (snap) => {\n        const preferenceUpdateEvent1 = child(participantRef, snap.key);\n        const preferenceUpdateEvent = child(preferenceUpdateEvent1, \"preferences\");\n        onChildChanged(preferenceUpdateEvent, (preferenceSnap) => {\n          props.updateParticipant({\n            [snap.key]: {\n              [preferenceSnap.key]: preferenceSnap.val(),\n            },\n          });\n        });\n        const { userName: name, preferences = {} } = snap.val();\n        // const audio = new Audio(notifyFile);\n        // audio.play(); /////////////////////////////////////////////////////////////////////////////////////\n        props.addParticipant({\n          [snap.key]: {\n            name,\n            ...preferences,\n          },\n        });\n      });\n      onChildRemoved(participantRef, (snap) => {\n        // const audio = new Audio(unnotifyFile);\n        // audio.play();\n        props.removeParticipant(snap.key);\n      });\n    }\n  }, [isStreamSet, isUserSet]);\n\n  return (\n    <div className=\"App\">\n      <MainScreen />\n    </div>\n  );\n}\n\nconst mapStateToProps = (state) => {\n  return {\n    stream: state.mainStream,\n    user: state.currentUser,\n  };\n};\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    setMainStream: (stream) => dispatch(setMainStream(stream)),\n    addParticipant: (user) => dispatch(addParticipant(user)),\n    setUser: (user) => dispatch(setUser(user)),\n    removeParticipant: (userId) => dispatch(removeParticipant(userId)),\n    updateParticipant: (user) => dispatch(updateParticipant(user)),\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(App);\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport Start from \"./start\";\nimport reportWebVitals from \"./reportWebVitals\";\nimport { Provider } from \"react-redux\";\nimport { createStore } from \"redux\";\nimport { userReducer } from \"./store/reducer\";\nimport { AuthProvider } from \"./context/auth\";\nimport { HashRouter, Route, Routes } from \"react-router-dom\";\nimport App from \"./App\";\n\nexport const store = createStore(userReducer);\nReactDOM.render(\n  <React.StrictMode>\n    <Provider store={store}>\n      <AuthProvider>\n        <HashRouter>\n        <Routes>\n                <Route path=\"/\" element={<Start />} />\n                <Route exact path=\"/video-chat-dpl\" element={<Start/>} />\n                <Route path=\"/room/:id\" element={<App />} />\n        </Routes>\n        </HashRouter>\n      </AuthProvider>\n    </Provider>\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}